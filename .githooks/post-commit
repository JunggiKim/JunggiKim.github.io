#!/bin/bash

# ============================================
# JunggiKim.github.io post-commit Hook
# 커밋 후 부모 repo(solodev_root) 포인터 자동 업데이트
# ============================================

PARENT_REPO=$(git rev-parse --show-superproject-working-tree 2>/dev/null)

if [ -z "$PARENT_REPO" ]; then
    exit 0
fi

# macOS 호환: Python으로 심볼릭 링크 해제 후 상대 경로 계산
SUBMODULE_REL=$(python3 -c "
import os
parent = os.path.realpath('$PARENT_REPO')
current = os.path.realpath(os.getcwd())
print(os.path.relpath(current, parent))
")

echo ""
echo "[post-commit] 부모 repo 포인터 업데이트 중..."
cd "$PARENT_REPO"
unset GIT_DIR GIT_WORK_TREE GIT_INDEX_FILE
git add "$SUBMODULE_REL"
git commit -m "chore: update submodule $SUBMODULE_REL" || true
echo "[post-commit] 완료!"
